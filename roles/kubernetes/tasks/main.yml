---
- name: Kubelet
  include_tasks: kubelet.yml
  tags: kubelet, deploy

- name: Master Certificates
  include_tasks: master-certificates.yml
  when: inventory_hostname in groups['kube-master']
  tags: certificates, deploy

- name: Certificates
  include_tasks: certificates.yml
  tags: certificates, deploy

- name: Apiserver
  include_tasks: apiserver.yml
  when: inventory_hostname in groups['kube-master']
  tags: apiserver, deploy

- name: Deploy admin access token
  include_tasks: tokens.yml
  tags: tokens, deploy
  
- name: Controller Manager
  include_tasks: controller-manager.yml
  when: inventory_hostname in groups['kube-master']
  tags: controller-manager, deploy

- name: Scheduler
  include_tasks: scheduler.yml
  when: inventory_hostname in groups['kube-master']
  tags: scheduler, deploy

- name: Kube-Proxy
  include_tasks: kube-proxy.yml
  tags: kube-proxy, deploy

- name: Startup the cluster
  include_tasks: start_kubernetes.yml
  tags: start, deploy

- name: Wait for kubernetes to be up
  include_tasks: start_wait.yml
  when: inventory_hostname in groups['kube-master']
  tags: start, deploy

- name: Prepare dns dirs
  include_tasks: kube-addon.yml
  when: inventory_hostname in groups['kube-master']
  tags: dns, deploy

- name: Install DNS
  include_tasks: kube-dns.yml
  when: inventory_hostname in groups['kube-master']
  run_once: true
  tags: dns, deploy
